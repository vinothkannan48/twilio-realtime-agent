# ---------------------------------------------------------------------
# 🐍 Base image
# ---------------------------------------------------------------------
FROM python:3.11-slim

# ---------------------------------------------------------------------
# 🎧 Install system dependencies
# ---------------------------------------------------------------------
RUN apt-get update && apt-get install -y ffmpeg && rm -rf /var/lib/apt/lists/*

# ---------------------------------------------------------------------
# 📁 Set working directory
# ---------------------------------------------------------------------
WORKDIR /app

# ---------------------------------------------------------------------
# 🧩 Copy requirements and force rebuild
# ---------------------------------------------------------------------
COPY requirements.txt .

# 🚀 Force rebuild: disable Docker cache
ARG CACHEBUST=1

# 🧹 Upgrade pip and force reinstall all dependencies fresh
RUN pip install --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# ---------------------------------------------------------------------
# 📂 Copy rest of your app
# ---------------------------------------------------------------------
COPY . .

# ---------------------------------------------------------------------
# 🔥 Expose port
# ---------------------------------------------------------------------
EXPOSE 10000

# ---------------------------------------------------------------------
# 🚀 Start the Flask realtime agent
# ---------------------------------------------------------------------
CMD ["python", "realtime_agent.py"]