# ---------------------------------------------------------------------
# ğŸ Base image
# ---------------------------------------------------------------------
FROM python:3.11-slim

# ---------------------------------------------------------------------
# ğŸ§ Install system dependencies
# ---------------------------------------------------------------------
RUN apt-get update && apt-get install -y ffmpeg && rm -rf /var/lib/apt/lists/*

# ---------------------------------------------------------------------
# ğŸ“ Set working directory
# ---------------------------------------------------------------------
WORKDIR /app

# ---------------------------------------------------------------------
# ğŸ§© Copy requirements and force rebuild
# ---------------------------------------------------------------------
COPY requirements.txt .

# ğŸš€ Force rebuild: disable Docker cache
ARG CACHEBUST=1

# ğŸ§¹ Upgrade pip and force reinstall all dependencies fresh
RUN pip install --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# ---------------------------------------------------------------------
# ğŸ“‚ Copy rest of your app
# ---------------------------------------------------------------------
COPY . .

# ---------------------------------------------------------------------
# ğŸ”¥ Expose port
# ---------------------------------------------------------------------
EXPOSE 10000

# ---------------------------------------------------------------------
# ğŸš€ Start the Flask realtime agent
# ---------------------------------------------------------------------
CMD ["python", "realtime_agent.py"]